pipeline {
     agent { docker { image 'php' } }
    stages {
        stage('Build')
            steps {
                
                sh 'php --version'
              
               
            }
        }
        stage('Unit test') {
            steps {
                
                sh 'composer --version'
                sh 'cp .env.example .env'
                sh 'php artisan key:generate'
                sh 'php artisan config:cache'
                sh 'vendor/bin/phpunit tests'
            }
        }
        stage('Code coverage') {
            steps {
                
                sh 'vendor/bin/phpunit --coverage-html 'reports/coverage''
               
            }
        }
        stage('Static code analysis larastan') {
            steps {
              
              sh 'vendor/bin/phpstan analyse --memory-limit=2G'  
              
            }
        }
        stage('Static code analysis phpcs') {
            steps {
               
                sh 'vendor/bin/phpcs'
              
            }
        }
        
      
 }
